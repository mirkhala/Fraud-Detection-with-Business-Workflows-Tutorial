---
- name: OCS - Create namespace
  k8s:
    name: "{{ ocs_ns }}"
    api_version: v1
    kind: Namespace
    state: present
    api_key: "{{ k8s_auth_results.k8s_auth.api_key }}"

- name: OCS - Create OperatorGroup
  k8s:
    state: present
    definition: "{{ lookup('template', 'templates/ocs-operator-group.yml.j2') | from_yaml }}"
    api_key: "{{ k8s_auth_results.k8s_auth.api_key }}"

- name: OCS - Create subscription
  k8s:
    state: present
    definition: "{{ lookup('template', 'templates/ocs-subscription.yml.j2') | from_yaml }}"
    api_key: "{{ k8s_auth_results.k8s_auth.api_key }}"
  register: csv

- name: OCS - Check OCS Operator install status
  include_tasks: check_ocs_operator_install.yml

- name: OCS - Create StorageCluster
  k8s:
    state: present
    definition: "{{ lookup('template', 'templates/ocs-storagecluster.yml.j2') | from_yaml }}"
    api_key: "{{ k8s_auth_results.k8s_auth.api_key }}"
  register: storage_cluster

- name: OCS - Check StorageCluster 
  include_tasks: check_ocs_storagecluster.yml 
