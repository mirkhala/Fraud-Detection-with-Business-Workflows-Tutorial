---
- name: Tasks to check Fraud model creation
  block:
    - name: Check status of pods in ccfd namespace
      k8s_info:
        api_key: "{{ k8s_auth_results.k8s_auth.api_key }}"
        api_version: v1
        kind: Pod
        namespace: "{{ demo_name }}"
        label_selectors:
          - seldon-app = modelfull-modelfull
      register: pod_list 

    - name: Validate pods status
      set_fact:
        pods_status: running_in_list and all_same_in_list
      vars:
        query: "resources[].status.phase"
        pods_status_list: "{{ pod_list | json_query(query) }}"
        running_in_list: "{{ 'Running' in pods_status_list | bool }}"
        all_same_in_list: "{{ pods_status_list | unique | length == 1 }}"

    - name: Check if ready
      fail: 
        msg: not ready yet
      when: pods_status == False 

  rescue:
    - include_tasks: check_modelfull_pod.yml 
        
